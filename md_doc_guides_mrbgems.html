<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>mruby: mrbgems</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="mruby_logo_red_icon.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">mruby
   &#160;<span id="projectnumber">2.0.1</span>
   </div>
   <div id="projectbrief">mruby is the lightweight implementation of the Ruby language</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">mrbgems </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>mrbgems is a library manager to integrate C and Ruby extension in an easy and standardised way into mruby.</p>
<h2>Usage</h2>
<p>By default mrbgems is currently deactivated. As soon as you add a GEM to your build configuration (i.e. <em>build_config.rb</em>), mrbgems will be activated and the extension integrated.</p>
<p>To add a GEM into the <em>build_config.rb</em> add the following line for example: </p><div class="fragment"><div class="line">conf.gem &#39;/path/to/your/gem/dir&#39;</div></div><!-- fragment --><p>You can also use a relative path which would be relative from the mruby root: </p><div class="fragment"><div class="line">conf.gem &#39;examples/mrbgems/ruby_extension_example&#39;</div></div><!-- fragment --><p>A remote GIT repository location for a GEM is also supported: </p><div class="fragment"><div class="line">conf.gem :git =&gt; &#39;https://github.com/masuidrive/mrbgems-example.git&#39;, :branch =&gt; &#39;master&#39;</div><div class="line">conf.gem :github =&gt; &#39;masuidrive/mrbgems-example&#39;, :branch =&gt; &#39;master&#39;</div><div class="line">conf.gem :bitbucket =&gt; &#39;mruby/mrbgems-example&#39;, :branch =&gt; &#39;master&#39;</div></div><!-- fragment --><p>You can specify the sub directory of the repository with <code>:path</code> option: </p><div class="fragment"><div class="line">conf.gem github: &#39;mruby/mruby&#39;, path: &#39;mrbgems/mruby-socket&#39;</div></div><!-- fragment --><p>To use mrbgem from <a href="https://github.com/mruby/mgem-list">mgem-list</a> use <code>:mgem</code> option: </p><div class="fragment"><div class="line">conf.gem :mgem =&gt; &#39;mruby-yaml&#39;</div><div class="line">conf.gem :mgem =&gt; &#39;yaml&#39; # &#39;mruby-&#39; prefix could be omitted</div></div><!-- fragment --><p>If there is missing dependencies, mrbgem dependencies solver will reference mrbgem from core or mgem-list.</p>
<p>To pull all gems from remote GIT repository on build, call <code>./minirake -p</code>, or <code>./minirake --pull-gems</code>.</p>
<p>NOTE: <code>:bitbucket</code> option supports only git. Hg is unsupported in this version.</p>
<h2>GemBox</h2>
<p>There are instances when you wish to add a collection of mrbgems into mruby at once, or be able to substitute mrbgems based on configuration, without having to add each gem to the <em>build_config.rb</em> file. A packaged collection of mrbgems is called a GemBox. A GemBox is a file that contains a list of mrbgems to load into mruby, in the same format as if you were adding them to <em>build_config.rb</em> via <code>config.gem</code>, but wrapped in an <code>MRuby::GemBox</code> object. GemBoxes are loaded into mruby via <code>config.gembox 'boxname'</code>.</p>
<p>Below we have created a GemBox containing <em>mruby-time</em> and <em>mrbgems-example</em>: </p><div class="fragment"><div class="line">MRuby::GemBox.new do |conf|</div><div class="line">  conf.gem &quot;#{root}/mrbgems/mruby-time&quot;</div><div class="line">  conf.gem :github =&gt; &#39;masuidrive/mrbgems-example&#39;</div><div class="line">end</div></div><!-- fragment --><p>As mentioned, the GemBox uses the same conventions as <code>MRuby::Build</code>. The GemBox must be saved with a *.gembox* extension inside the <em>mrbgems</em> directory to to be picked up by mruby.</p>
<p>To use this example GemBox, we save it as <code>custom.gembox</code> inside the <em>mrbgems</em> directory in mruby, and add the following to our <em>build_config.rb</em> file inside the build block: </p><div class="fragment"><div class="line">conf.gembox &#39;custom&#39;</div></div><!-- fragment --><p> This will cause the <em>custom</em> GemBox to be read in during the build process, adding <em>mruby-time</em> and <em>mrbgems-example</em> to the build.</p>
<p>If you want, you can put GemBox outside of mruby directory. In that case you must specify an absolute path like below. </p><div class="fragment"><div class="line">conf.gembox &quot;#{ENV[&quot;HOME&quot;]}/mygemboxes/custom&quot;</div></div><!-- fragment --><p>There are two GemBoxes that ship with mruby: <a href="../../mrbgems/default.gembox">default</a> and <a href="../../mrbgems/full-core.gembox">full-core</a>. The <a href="../../mrbgems/default.gembox">default</a> GemBox contains several core components of mruby, and <a href="../../mrbgems/full-core.gembox">full-core</a> contains every gem found in the <em>mrbgems</em> directory.</p>
<h2>GEM Structure</h2>
<p>The maximal GEM structure looks like this: </p><pre class="fragment">+- GEM_NAME         &lt;- Name of GEM
   |
   +- include/      &lt;- Header for Ruby extension (will exported)
   |
   +- mrblib/       &lt;- Source for Ruby extension
   |
   +- src/          &lt;- Source for C extension
   |
   +- test/         &lt;- Test code (Ruby)
   |
   +- mrbgem.rake   &lt;- GEM Specification
   |
   +- README.md     &lt;- Readme for GEM
</pre><p>The folder <em>mrblib</em> contains pure Ruby files to extend mruby. The folder <em>src</em> contains C/C++ files to extend mruby. The folder <em>include</em> contains C/C++ header files. The folder <em>test</em> contains C/C++ and pure Ruby files for testing purposes which will be used by <code>mrbtest</code>. <em>mrbgem.rake</em> contains the specification to compile C and Ruby files. <em>README.md</em> is a short description of your GEM.</p>
<h2>Build process</h2>
<p>mrbgems expects a specification file called <em>mrbgem.rake</em> inside of your GEM directory. A typical GEM specification could look like this for example: </p><div class="fragment"><div class="line">MRuby::Gem::Specification.new(&#39;c_and_ruby_extension_example&#39;) do |spec|</div><div class="line">  spec.license = &#39;MIT&#39;</div><div class="line">  spec.author  = &#39;mruby developers&#39;</div><div class="line">  spec.summary = &#39;Example mrbgem using C and ruby&#39;</div><div class="line">end</div></div><!-- fragment --><p>The mrbgems build process will use this specification to compile Object and Ruby files. The compilation results will be added to <em>lib/libmruby.a</em>. This file exposes the GEM functionality to tools like <code>mruby</code> and <code>mirb</code>.</p>
<p>The following properties can be set inside of your <code>MRuby::Gem::Specification</code> for information purpose:</p>
<ul>
<li><code>spec.license</code> or <code>spec.licenses</code> (A single license or a list of them under which this GEM is licensed)</li>
<li><code>spec.author</code> or <code>spec.authors</code> (Developer name or a list of them)</li>
<li><code>spec.version</code> (Current version)</li>
<li><code>spec.description</code> (Detailed description)</li>
<li><code>spec.summary</code><ul>
<li>One line short description of mrbgem.</li>
<li>Printed in build summary of rake when set.</li>
</ul>
</li>
<li><code>spec.homepage</code> (Homepage)</li>
<li><code>spec.requirements</code> (External requirements as information for user)</li>
</ul>
<p>The <code>license</code> and <code>author</code> properties are required in every GEM!</p>
<p>In case your GEM is depending on other GEMs please use <code>spec.add_dependency(gem, *requirements[, default_get_info])</code> like: </p><div class="fragment"><div class="line">MRuby::Gem::Specification.new(&#39;c_and_ruby_extension_example&#39;) do |spec|</div><div class="line">  spec.license = &#39;MIT&#39;</div><div class="line">  spec.author  = &#39;mruby developers&#39;</div><div class="line"></div><div class="line">  # Add GEM dependency mruby-parser.</div><div class="line">  # The version must be between 1.0.0 and 1.5.2 .</div><div class="line">  spec.add_dependency(&#39;mruby-parser&#39;, &#39;&gt;= 1.0.0&#39;, &#39;&lt;= 1.5.2&#39;)</div><div class="line"></div><div class="line">  # Use any version of mruby-uv from github.</div><div class="line">  spec.add_dependency(&#39;mruby-uv&#39;, &#39;&gt;= 0.0.0&#39;, :github =&gt; &#39;mattn/mruby-uv&#39;)</div><div class="line"></div><div class="line">  # Use latest mruby-onig-regexp from github. (version requirements can be omitted)</div><div class="line">  spec.add_dependency(&#39;mruby-onig-regexp&#39;, :github =&gt; &#39;mattn/mruby-onig-regexp&#39;)</div><div class="line"></div><div class="line">  # You can add extra mgems active only on test</div><div class="line">  spec.add_test_dependency(&#39;mruby-process&#39;, :github =&gt; &#39;iij/mruby-process&#39;)</div><div class="line">end</div></div><!-- fragment --><p>The version requirements and default gem information are optional.</p>
<p>Version requirement supports following operators:</p><ul>
<li>'=': is equal</li>
<li>'!=': is not equal</li>
<li>'&gt;': is greater</li>
<li>'&lt;': is lesser</li>
<li>'&gt;=': is equal or greater</li>
<li>'&lt;=': is equal or lesser</li>
<li>'~&gt;': is equal or greater and is lesser than the next major version<ul>
<li>example 1: '~&gt; 2.2.2' means '&gt;= 2.2.2' and '&lt; 2.3.0'</li>
<li>example 2: '~&gt; 2.2' means '&gt;= 2.2.0' and '&lt; 3.0.0'</li>
</ul>
</li>
</ul>
<p>When more than one version requirements is passed, the dependency must satisfy all of it.</p>
<p>You can have default gem to use as dependency when it's not defined in <em>build_config.rb</em>. When the last argument of <code>add_dependency</code> call is <code>Hash</code>, it will be treated as default gem information. Its format is same as argument of method <code>MRuby::Build::gem</code>, expect that it can't be treated as path gem location.</p>
<p>When a special version of dependency is required, use <code>MRuby::Build::gem</code> in <em>build_config.rb</em> to override default gem.</p>
<p>If you have conflicting GEMs use the following method:</p><ul>
<li><code>spec.add_conflict(gem, *requirements)</code><ul>
<li>The <code>requirements</code> argument is same as in <code>add_dependency</code> method.</li>
</ul>
</li>
</ul>
<p>like following code: </p><div class="fragment"><div class="line">MRuby::Gem::Specification.new &#39;some-regexp-binding&#39; do |spec|</div><div class="line">  spec.license = &#39;BSD&#39;</div><div class="line">  spec.author = &#39;John Doe&#39;</div><div class="line"></div><div class="line">  spec.add_conflict &#39;mruby-onig-regexp&#39;, &#39;&gt; 0.0.0&#39;</div><div class="line">  spec.add_conflict &#39;mruby-hs-regexp&#39;</div><div class="line">  spec.add_conflict &#39;mruby-pcre-regexp&#39;</div><div class="line">  spec.add_conflict &#39;mruby-regexp-pcre&#39;</div><div class="line">end</div></div><!-- fragment --><p>In case your GEM has more complex build requirements you can use the following options additionally inside of your GEM specification:</p>
<ul>
<li><code>spec.cc.flags</code> (C compiler flags)</li>
<li><code>spec.cc.defines</code> (C compiler defines)</li>
<li><code>spec.cc.include_paths</code> (C compiler include paths)</li>
<li><code>spec.linker.flags</code> (Linker flags)</li>
<li><code>spec.linker.libraries</code> (Linker libraries)</li>
<li><code>spec.linker.library_paths</code> (Linker additional library path)</li>
<li><code>spec.bins</code> (Generate binary file)</li>
<li><code>spec.rbfiles</code> (Ruby files to compile)</li>
<li><code>spec.objs</code> (Object files to compile)</li>
<li><code>spec.test_rbfiles</code> (Ruby test files for integration into mrbtest)</li>
<li><code>spec.test_objs</code> (Object test files for integration into mrbtest)</li>
<li><code>spec.test_preload</code> (Initialization files for mrbtest)</li>
</ul>
<p>You also can use <code>spec.mruby.cc</code> and <code>spec.mruby.linker</code> to add extra global parameters for compiler and linker.</p>
<h3>include_paths and dependency</h3>
<p>Your GEM can export include paths to another GEMs that depends on your GEM. By default, <code>/...absolute path.../{GEM_NAME}/include</code> will be exported. So it is recommended not to put GEM's local header files on include/.</p>
<p>These exports are retroactive. For example: when B depends to C and A depends to B, A will get include paths exported by C.</p>
<p>Exported include_paths are automatically appended to GEM local include_paths by Minirake. You can use <code>spec.export_include_paths</code> accessor if you want more complex build.</p>
<h2>C Extension</h2>
<p>mruby can be extended with C. This is possible by using the C API to integrate C libraries into mruby.</p>
<h3>Preconditions</h3>
<p>mrbgems expects that you have implemented a C method called <code>mrb_YOURGEMNAME_gem_init(mrb_state)</code>. <code>YOURGEMNAME</code> will be replaced by the name of your GEM. If you call your GEM <em>c_extension_example</em>, your initialisation method could look like this: </p><div class="fragment"><div class="line"><span class="keywordtype">void</span></div><div class="line">mrb_c_extension_example_gem_init(<a class="code" href="structmrb__state.html">mrb_state</a>* mrb) {</div><div class="line">  <span class="keyword">struct </span><a class="code" href="structRClass.html">RClass</a> *class_cextension = mrb_define_module(mrb, <span class="stringliteral">&quot;CExtension&quot;</span>);</div><div class="line">  mrb_define_class_method(mrb, class_cextension, <span class="stringliteral">&quot;c_method&quot;</span>, mrb_c_method, MRB_ARGS_NONE());</div><div class="line">}</div></div><!-- fragment --><h3>Finalize</h3>
<p>mrbgems expects that you have implemented a C method called <code>mrb_YOURGEMNAME_gem_final(mrb_state)</code>. <code>YOURGEMNAME</code> will be replaced by the name of your GEM. If you call your GEM <em>c_extension_example</em>, your finalizer method could look like this:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span></div><div class="line">mrb_c_extension_example_gem_final(<a class="code" href="structmrb__state.html">mrb_state</a>* mrb) {</div><div class="line">  free(someone);</div><div class="line">}</div></div><!-- fragment --><h3>Example</h3>
<pre class="fragment">+- c_extension_example/
   |
   +- src/
   |  |
   |  +- example.c         &lt;- C extension source
   |
   +- test/
   |  |
   |  +- example.rb        &lt;- Test code for C extension
   |
   +- mrbgem.rake          &lt;- GEM specification
   |
   +- README.md
</pre><h2>Ruby Extension</h2>
<p>mruby can be extended with pure Ruby. It is possible to override existing classes or add new ones in this way. Put all Ruby files into the <em>mrblib</em> folder.</p>
<h3>Pre-Conditions</h3>
<p>none</p>
<h3>Example</h3>
<pre class="fragment">+- ruby_extension_example/
   |
   +- mrblib/
   |  |
   |  +- example.rb        &lt;- Ruby extension source
   |
   +- test/
   |  |
   |  +- example.rb        &lt;- Test code for Ruby extension
   |
   +- mrbgem.rake          &lt;- GEM specification
   |
   +- README.md
</pre><h2>C and Ruby Extension</h2>
<p>mruby can be extended with C and Ruby at the same time. It is possible to override existing classes or add new ones in this way. Put all Ruby files into the <em>mrblib</em> folder and all C files into the <em>src</em> folder.</p>
<p>mruby codes under <em>mrblib</em> directory would be executed after gem init C function is called. Make sure <em>mruby script</em> depends on <em>C code</em> and <em>C code</em> doesn't depend on <em>mruby script</em>.</p>
<h3>Pre-Conditions</h3>
<p>See C and Ruby example.</p>
<h3>Example</h3>
<pre class="fragment">+- c_and_ruby_extension_example/
   |
   +- mrblib/
   |  |
   |  +- example.rb        &lt;- Ruby extension source
   |
   +- src/
   |  |
   |  +- example.c         &lt;- C extension source
   |
   +- test/
   |  |
   |  +- example.rb        &lt;- Test code for C and Ruby extension
   |
   +- mrbgem.rake          &lt;- GEM specification
   |
   +- README.md</pre> </div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
